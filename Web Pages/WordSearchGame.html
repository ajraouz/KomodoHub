<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="WordSearchGame.css">
    <title>Word Search Game</title>
</head>
<body>
    <div class="navbar">
        <a href="HomePage.html">
            <img src="images/komodoLogo.png" alt="Logo" class="logo">
        </a>
        
        <div class="nav-center">
            <a href="CommunityLibrary.html"><button>Community Library</button></a>
            <a href="SchoolLibrary.html"><button>School Library</button></a>
            <a href="Post.html"><button>Post</button></a>
            <a href="Games.html"><button>Games</button></a>
        </div>
    
        <a href="LoginPage.html"><button class="login">Login</button></a>
    </div>
    
    <div id="difficulty-screen">
        <div id="difficulty-container">
            <h2>Select your Difficulty</h2>
            <button class="difficulty-btn easy" onclick="startGame('easy')">EASY</button>
            <button class="difficulty-btn medium" onclick="startGame('medium')">MEDIUM</button>
            <button class="difficulty-btn hard" onclick="startGame('hard')">HARD</button>
        </div>
    </div>


    <div id="game-container" style="display: none;">
        <div class="back-button-container">
            <button id="back-button" onclick="goBack()">Back</button>
        </div>
        
        <h1>CROSSWORD</h1>
        <h2>WORD SEARCH PUZZLE</h2>

        <div class="container">
            <div id="word-list">
                <h2>Find These Words:</h2>
                <ul id="words"></ul>
            </div>
            <div id="grid"></div>
        </div>
    </div>

    <script>
        function goBack() {
            let gameContainer = document.getElementById("game-container");
            let difficultyScreen = document.getElementById("difficulty-screen");
        
            if (gameContainer && difficultyScreen) {
                gameContainer.style.display = "none"; 
                difficultyScreen.style.display = "flex"; 
            } else {
                console.error("Error: One or more elements not found.");
            }
        }
        

        function startGame(difficulty) {
            console.log("Selected difficulty:", difficulty); 
        
            document.getElementById("difficulty-screen").style.display = "none";
            document.getElementById("game-container").style.display = "block"; 
            
            initializeGame(difficulty); 
        }

        function initializeGame(difficulty) {
            let words, gridSize, cellSize;
        
            if (difficulty === "easy") {
                words = ["KOMODO", "MALEO", "ORANGUTAN", "BANTENG", "TARSIUS"];
                gridSize = 7;
                cellSize = 45;
            } else if (difficulty === "medium") {
                words = ["KOMODO", "MALEO", "ORANGUTAN", "BANTENG", "TARSIUS",
                        "ANOA", "JAVAN RHINOCEROS", "JAVAN GIBBON", "BALI MYNA"];
                gridSize = 12;
                cellSize = 35;
            } else if (difficulty === "hard") {
                words = ["ORANGUTAN", "BEKANTAN", "KOMODO", "BALI MYNA", "MALEO", "BABIRUSA",
                        "ANOA", "JAVAN EAGLE", "TARSIUS", "SUMATRAN TIGER", "JAVAN RHINOCEROS"];
                gridSize = 15;
                cellSize = 30;
            }
        
            const gridElement = document.getElementById("grid");
            const wordListElement = document.getElementById("words");
            const backButton = document.getElementById("back-button");
            const messageElement = document.getElementById("message"); 
        
            let grid = Array.from({ length: gridSize }, () => Array(gridSize).fill(null));
            let selectedCells = [];
            let foundWords = new Set();
            let isMouseDown = false;
        
            const directions = [
                [1, 0], [0, 1], [1, 1], [-1, 1], 
                [-1, 0], [0, -1], [-1, -1], [1, -1]
            ];
        
            function canPlaceWord(word, row, col, dx, dy) {
                for (let i = 0; i < word.length; i++) {
                    let x = row + dx * i, y = col + dy * i;
                    if (x >= gridSize || y >= gridSize || x < 0 || y < 0 || (grid[x][y] !== null && grid[x][y] !== word[i])) {
                        return false;
                    }
                }
                return true;
            }
        
            function placeWord(word) {
                word = word.replace(/\s+/g, "");
        
                for (let attempt = 0; attempt < 200; attempt++) { 
                    let row = Math.floor(Math.random() * gridSize);
                    let col = Math.floor(Math.random() * gridSize);
                    let [dx, dy] = directions[Math.floor(Math.random() * directions.length)];
        
                    if (canPlaceWord(word, row, col, dx, dy)) {
                        for (let i = 0; i < word.length; i++) {
                            grid[row + dx * i][col + dy * i] = word[i];
                        }
                        return true;
                    }
                }
                return false; 
            }
        
            words.forEach(word => {
                let placed = placeWord(word);
                if (!placed) console.warn(`Failed to place word: ${word}`);
            });
        
            for (let i = 0; i < gridSize; i++) {
                for (let j = 0; j < gridSize; j++) {
                    if (grid[i][j] === null) {
                        grid[i][j] = String.fromCharCode(65 + Math.floor(Math.random() * 26));
                    }
                }
            }
        
            gridElement.innerHTML = '';
            gridElement.style.gridTemplateColumns = `repeat(${gridSize}, ${cellSize}px)`;
            gridElement.style.width = `${gridSize * cellSize}px`;
            gridElement.style.height = `${gridSize * cellSize}px`;
        
            grid.forEach((row, r) => {
                row.forEach((letter, c) => {
                    let cell = document.createElement("div");
                    cell.classList.add("cell");
                    cell.textContent = letter;
                    cell.dataset.row = r;
                    cell.dataset.col = c;
        
                    cell.style.width = `${cellSize}px`;
                    cell.style.height = `${cellSize}px`;
                    cell.style.fontSize = `${cellSize * 0.6}px`;
        
                    cell.addEventListener("mousedown", (event) => {
                        isMouseDown = true;
                        toggleCellSelection(cell);
                        event.preventDefault();
                    });
        
                    cell.addEventListener("mouseenter", () => {
                        if (isMouseDown) {
                            toggleCellSelection(cell);
                        }
                    });
        
                    cell.addEventListener("mouseup", () => {
                        isMouseDown = false;
                        checkWord();
                    });
        
                    gridElement.appendChild(cell);
                });
            });
        
            wordListElement.innerHTML = "";
            words.forEach(word => {
                let li = document.createElement("li");
                li.textContent = word;
                li.dataset.word = word.replace(/\s+/g, "");
                wordListElement.appendChild(li);
            });
        
            document.addEventListener("mouseup", () => {
                isMouseDown = false;
                checkWord();
            });
        
            function toggleCellSelection(cell) {
                if (cell.classList.contains("found")) return;
        
                if (cell.classList.contains("selected")) {
                    cell.classList.remove("selected");
                    selectedCells = selectedCells.filter(c => c !== cell);
                } else {
                    cell.classList.add("selected");
                    selectedCells.push(cell);
                }
            }
        
            function checkWord() {
    let selectedWord = selectedCells.map(c => c.textContent).join("");
    let reversedWord = selectedWord.split("").reverse().join("");


    let normalizedWords = words.map(w => w.replace(/\s+/g, ""));

    if (normalizedWords.includes(selectedWord) && !foundWords.has(selectedWord)) {
        markWordAsFound(selectedWord);
    } else if (normalizedWords.includes(reversedWord) && !foundWords.has(reversedWord)) {
        markWordAsFound(reversedWord);
    }
}

function markWordAsFound(word) {
    selectedCells.forEach(c => {
        c.classList.add("found"); 
        c.style.backgroundColor = "green"; 
        c.style.color = "white"; 
    });

    let wordListItem = document.querySelector(`[data-word="${word}"]`);
    if (wordListItem) {
        wordListItem.classList.add("word-found");
        wordListItem.style.color = "green";  
        wordListItem.style.fontWeight = "bold";
    }

    foundWords.add(word);
    selectedCells = [];

    // Check if all words are found
    if (foundWords.size === words.length) {
        alert("ðŸŽ‰ You found all the words! ðŸŽ‰");
    }
}

            function checkWord() {
                let selectedWord = selectedCells.map(c => c.textContent).join("");
                let reversedWord = selectedWord.split("").reverse().join("");

                // Normalize words in the list
                let normalizedWords = words.map(w => w.replace(/\s+/g, ""));

                if (normalizedWords.includes(selectedWord) && !foundWords.has(selectedWord)) {
                    markWordAsFound(selectedWord);
                } else if (normalizedWords.includes(reversedWord) && !foundWords.has(reversedWord)) {
                    markWordAsFound(reversedWord);
                }
            }

        
            function markWordAsFound(word) {
                selectedCells.forEach(c => {
                    c.classList.add("found");
                    c.style.backgroundColor = "green"; 
                    c.style.color = "white"; 
                });
        
                let wordListItem = document.querySelector(`[data-word="${word}"]`);
                if (wordListItem) {
                    wordListItem.classList.add("word-found");
                    wordListItem.style.color = "green"; 
                    wordListItem.style.fontWeight = "bold";
                }
        
                foundWords.add(word);
                selectedCells = [];
        
                if (foundWords.size === words.length) {
                    messageElement.textContent = "ðŸŽ‰ You found all the words! ðŸŽ‰";
                    messageElement.classList.add("win-message");
                }
            }
        }
        
    </script>

</body>
</html>
