<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register to Komodo Hub</title>
    <link rel="stylesheet" href="/Web Pages/LoginRegister.css" type="text/css">
</head>
<body>
    <div class="navbar">
        <a href="/Web Pages/HomePage.html">
            <img src="/Web Pages/Images/komodoLogo.png" alt="Logo" class="logo">
        </a>
    </div>
    <div class="form-container register-box">
        <h2 class="form-title">Register to Komodo Hub</h2>
        <form id="registerForm" action="/register" method="POST">
            <input type="text" name="name" placeholder="Name *" required>
            <input type="text" name="username" placeholder="Username *" required>
            <input type="password" name="password" placeholder="Password *" required>
            <input type="password" name="confirm_password" placeholder="Confirm password *" required>

            <div class="dropdown">
                <select name="user_type" id="dropdown" required>
                    <option value="student">Student</option>
                    <option value="teacher">Teacher</option>
                    <option value="member">Member</option>
                </select>
            </div>
    
            <input id="accessCode" name="access_code" type="text" placeholder="Access code" required>

            <img src="/Web Pages/Images/giphy.gif" alt="Loading animation" class="gif">

            <button id="submit" type="submit" class="submit-button">Register</button>

        </form>
        <p class="redirect">
            Already have an account? <a href="/Web Pages/LoginPage.html">Login</a>
        </p>
    </div>

    <script>
        document.getElementById('dropdown').addEventListener('change', function () {
            let selectedValue = this.value;
            let accessCodeInput = document.getElementById('accessCode');
            let button = document.getElementById('submit');

            // Show/hide access code field based on selection
            if (selectedValue === 'student' || selectedValue === 'teacher') {
                accessCodeInput.style.display = 'block';
                accessCodeInput.required = true;
                button.textContent = 'Register';
            }
            else if (selectedValue === 'member') {
                accessCodeInput.style.display = 'none';
                accessCodeInput.required = false;
                button.textContent = 'Go to Payment Page';
            }
            else {
                accessCodeInput.style.display = 'none';
                accessCodeInput.required = false;
            }
        });

        document.getElementById('registerForm').addEventListener('submit', function(event) {
            event.preventDefault(); // Prevent default form submission

            let name = document.querySelector('input[placeholder="Name *"]').value;
            let username = document.querySelector('input[placeholder="Username *"]').value;
            let password = document.querySelector('input[placeholder="Password *"]').value;
            let confirmPassword = document.querySelector('input[placeholder="Confirm password *"]').value;
            let userType = document.getElementById('dropdown').value;
            let accessCode = document.getElementById('accessCode').value;

            if (password !== confirmPassword) {
                alert("Passwords do not match!");
                return;
            }

            // Prepare user data for registration
            let formData = new FormData();
            formData.append('name', name);
            formData.append('username', username);
            formData.append('password', password);
            formData.append('user_type', userType);

            // If user is a member, store the data in localStorage and redirect to payment page
            if (userType === 'member') {
                localStorage.setItem('registrationData', JSON.stringify({
                    name: name,
                    username: username,
                    password: password,
                    userType: userType
                }));
                
                // Redirect to payment page
                window.location.replace('/Web Pages/PaymentPage.html');
            }

            else if (userType === 'student' || userType === 'teacher') {
                formData.append('access_code', accessCode);
                // Handle student or teacher registration immediately
                fetch('/register', {
                    method: 'POST',
                    body: formData
                })
                .then(async response => {
                    let result = await response.json(); // Parse JSON correctly
                    if (response.ok) {
                        alert(result.message);
                        window.location.replace('/Web Pages/LoginPage.html');  // Redirect to login page
                    } else {
                        alert("Error: " + result.error);
                    }
                })
                .catch(error => {
                    console.error("Error:", error);
                    alert("An error occurred while registering.");
                });
            }
        });
    </script>
</body>
</html>

